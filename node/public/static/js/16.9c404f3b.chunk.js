(this.webpackJsonprewer=this.webpackJsonprewer||[]).push([[16],{100:function(e,t,n){},113:function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return F}));var a=n(20),r=n(2),s=n.n(r),i=n(19),c=n(3),o=n(12),l=n(0),u=n.n(l),d=n(13),p=n(62),f=n(26),m=n(106),b="/season/insert_season",v="/season/delete_season",j=n(65),O=(n(100),function(e){var t=e.season,n=e.selectedId,a=e.onSelected,r=Object(l.useState)("season-grid"),s=Object(o.a)(r,2),i=s[0],c=s[1];return Object(l.useEffect)((function(){t.id===n?c("season-grid selected-row"):c("season-grid")}),[n]),u.a.createElement("div",{onClick:function(){a()},className:i},u.a.createElement("p",null,"Season ",t.order),u.a.createElement("p",null,t.releaseYear),u.a.createElement("p",null,t.episodes.length," episodes"))}),E=n(57),h=function(e){var t=e.episode,n=e.selectedId,a=e.onSelect,r=e.onDelete,s=Object(l.useState)("edit-episode-row"),i=Object(o.a)(s,2),c=i[0],d=i[1];return Object(l.useEffect)((function(){n===t.id?d("edit-episode-row selected-row"):d("edit-episode-row")}),[n]),u.a.createElement("div",{onClick:a,className:c},u.a.createElement("p",null,t.title),u.a.createElement("p",null,Object(E.d)(t.releaseDate.toString())),u.a.createElement("p",null,u.a.createElement("button",{onClick:r},"Delete")))},g=n(4),y=n(6),S=n(56),w=n(105),x=n(108),k=n(59),C=function(e){var t=e.season,n=e.setEpisodes,r=e.summary,m=Object(S.e)({id:0,title:"",summary:"",releaseDate:"",genres:[],casts:[]}),b=Object(o.a)(m,3),v=b[0],O=b[1],C=b[2],I=Object(d.postCaller)(),D=Object(o.a)(I,2),N=D[0],F=D[1],T=Object(l.useContext)(f.a).messenger;function _(){return(_=Object(c.a)(s.a.mark((function e(){var c,o,l,u;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return l=45,t.episodes.length>0?(o=new Date(t.episodes[t.episodes.length-1].releaseDate),l=t.episodes[t.episodes.length-1].runtime):o=isNaN(parseInt(t.releaseYear))?new Date("2015-01-01"):new Date("".concat(t.releaseYear,"-01-01")),u={id:0,title:"Season ".concat(t.order,": episode ").concat(t.episodes.length+1),runtime:l,summary:r,genres:[],releaseDate:Object(E.f)(o),seasonId:t.id,casts:[]},e.next=5,N(u,k.b.insertMovie,d.ECallType.INSERT);case 5:(c=e.sent)>0?(n([].concat(Object(a.a)(t.episodes),[Object(i.a)(Object(i.a)({},u),{},{id:c})])),O(Object(i.a)(Object(i.a)({},u),{},{id:c}))):T.addFail("Server error: could not add new episode.");case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function R(){return(R=Object(c.a)(s.a.mark((function e(){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,N(v,k.b.updateMovie,d.ECallType.ISOK);case 2:if(!e.sent){e.next=7;break}T.addSuccess("Episode details saved.",5e3),n(Object(j.a)(t.episodes,t.episodes.find((function(e){return e.id===v.id})),v)),e.next=8;break;case 7:T.addFail("Server error: series details could not be saved.");case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Y(){return(Y=Object(c.a)(s.a.mark((function e(a){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,N({id:a},k.b.deleteMovie,d.ECallType.ISOK);case 2:if(!e.sent){e.next=7;break}n(t.episodes.filter((function(e){return e.id!==a}))),v.id===a&&O({id:0,title:"",summary:"",releaseDate:"",genres:[],casts:[]}),e.next=8;break;case 7:T.addFail("Server error: could not delete episode.");case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}return Object(l.useEffect)((function(){return v.id>0&&n(Object(j.a)(t.episodes,t.episodes.find((function(e){return e.id===v.id})),v)),function(){F.abort(),T.clear()}}),[v.casts]),u.a.createElement("div",null,t.episodes.sort(p.a).map((function(e){return u.a.createElement(h,{key:"".concat(e.id),onDelete:function(){!function(e){Y.apply(this,arguments)}(e.id)},episode:e,selectedId:v.id,onSelect:function(){O(e)}})})),u.a.createElement("div",{onClick:function(){return _.apply(this,arguments)},className:"add-episode"},u.a.createElement(g.a,{icon:y.k})),v.id>0?u.a.createElement(l.Fragment,null,u.a.createElement("button",{onClick:function(){return R.apply(this,arguments)}},"Save"),u.a.createElement(w.a,{movie:v,setMovie:O,movieBinder:C}),u.a.createElement(x.a,{movie:v,setMovie:O,season:t,setEpisodes:n})):u.a.createElement(l.Fragment,null))},I=function(e){var t=e.series,n=e.setSeasons,r=Object(l.useState)(""),p=Object(o.a)(r,2),m=p[0],E=p[1],h=Object(l.useState)({id:0,seriesId:t.id,episodes:[]}),g=Object(o.a)(h,2),y=g[0],S=g[1],w=Object(d.postCaller)(),x=Object(o.a)(w,2),k=x[0],I=x[1],D=Object(l.useContext)(f.a).messenger;function N(){return(N=Object(c.a)(s.a.mark((function e(){var r;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r={id:0,seriesId:t.id,releaseYear:m,episodes:[],order:t.seasons.length+1},e.next=3,k(r,b,d.ECallType.INSERT);case 3:r.id=e.sent,r.id&&n([].concat(Object(a.a)(t.seasons),[r]));case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function F(){return(F=Object(c.a)(s.a.mark((function e(){var a;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.seasons[t.seasons.length-1].id,e.next=3,k({id:a},v,d.ECallType.ISOK);case 3:if(!e.sent){e.next=7;break}n(t.seasons.filter((function(e){return e.id!==a}))),e.next=8;break;case 7:D.addFail("Server error: could not remove season.");case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}return Object(l.useEffect)((function(){return function(){I.abort(),D.clear()}}),[]),u.a.createElement("div",null,u.a.createElement("div",{className:"adder-panel"},u.a.createElement("h3",null,"Add new season: "),u.a.createElement("label",null,"Year"),u.a.createElement("input",{value:m,onChange:function(e){E(e.target.value)},name:"releaseYear",placeholder:"release"}),u.a.createElement("button",{onClick:function(){return N.apply(this,arguments)}},"Add new season"),t.seasons.length>0?u.a.createElement("button",{onClick:function(){return F.apply(this,arguments)}},"Delete last season"):u.a.createElement(l.Fragment,null)),t.seasons.map((function(e){return u.a.createElement(O,{key:e.id,selectedId:y.id,onSelected:function(){return n=e.id,void S(t.seasons.find((function(e){return e.id===n})));var n},season:e})})),t.seasons.length>0?u.a.createElement(l.Fragment,null,u.a.createElement("h2",{className:"series-title"},"Episodes:"),u.a.createElement("div",null,u.a.createElement(C,{season:y,setEpisodes:function(e){var a;a=e,n(Object(j.a)(t.seasons,t.seasons.find((function(e){return e.id===y.id})),Object(i.a)(Object(i.a)({},y),{},{episodes:a}))),S(Object(i.a)(Object(i.a)({},y),{},{episodes:a}))},summary:t.summary}))):u.a.createElement(l.Fragment,null))},D=(n(58),function(e){var t=e.series,n=(e.setSeries,e.bindSeries),a=Object(l.useRef)(),r=Object(S.g)("/rewer/uploads/seriesposters","".concat(t.id,".jpg")),i=Object(o.a)(r,3),d=i[0],m=i[1],b=i[2],v=Object(l.useContext)(f.a).messenger;function O(){return(O=Object(c.a)(s.a.mark((function e(){var n,r;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=new FormData,a.current.files[0]){e.next=4;break}return v.addWarning("No file is selected.",5e3),e.abrupt("return");case 4:return e.next=6,Object(j.b)(a.current.files[0],400,600,.8);case 6:return r=e.sent,n.append("poster",r,"".concat(t.id,".jpg")),e.next=10,Object(p.j)(n);case 10:if(!e.sent){e.next=14;break}b("/rewer/uploads/seriesposters","".concat(t.id,".jpg?").concat((new Date).getTime())),e.next=15;break;case 14:v.addFail("Server error: upload unsuccessful.");case 15:case"end":return e.stop()}}),e)})))).apply(this,arguments)}return Object(l.useEffect)((function(){return function(){v.clear()}}),[]),u.a.createElement(l.Fragment,null,u.a.createElement("div",{className:"detail-grid"},u.a.createElement("div",{className:"span-2"},u.a.createElement("input",{value:t.title,onChange:n,name:"title",type:"text",placeholder:"Title",className:"title-input"}),u.a.createElement("br",null),u.a.createElement("textarea",{value:t.summary,onChange:n,name:"summary",placeholder:"Write something about the story...",rows:20})),u.a.createElement("div",null,u.a.createElement("img",{src:d,onError:m,alt:"Poster",title:"Poster",className:"edit-poster"}),t.id>0?u.a.createElement(l.Fragment,null,u.a.createElement("p",null,"It is recommended to use an image with a standard poster image ratio"),u.a.createElement("input",{ref:a,type:"file",accept:".png,.jpg,.jpeg",className:"file-input"}),u.a.createElement("button",{onClick:function(){return O.apply(this,arguments)}},"Upload")):u.a.createElement(l.Fragment,null,u.a.createElement("p",null,"Create the series' page to edit this picture.")))))}),N=n(21);function F(){var e=Object(S.e)({id:parseInt(Object(N.b)("seriesId")),title:"",summary:"",seasons:[],genres:[],avgScore:0}),t=Object(o.a)(e,3),n=t[0],r=t[1],b=t[2],v=Object(d.postCaller)(),j=Object(o.a)(v,2),O=j[0],E=j[1],h=Object(l.useContext)(f.a).messenger;function g(){return(g=Object(c.a)(s.a.mark((function e(){var t;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,O({id:n.id},p.i.selectDetailedSeries,d.ECallType.SELECT);case 2:(t=e.sent)&&r(t);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function y(){return(y=Object(c.a)(s.a.mark((function e(){var t;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,O(n,p.i.insertSeries,d.ECallType.INSERT);case 2:(t=e.sent)?(r(Object(i.a)(Object(i.a)({},n),{},{id:t})),Object(N.a)({name:"seriesId",value:t.toString()}),h.addSuccess("Series page created.",5e3)):h.addFail("Server error: could not create series page.");case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function w(){return(w=Object(c.a)(s.a.mark((function e(){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,O(n,p.i.updateSeries,d.ECallType.ISOK);case 2:if(!e.sent){e.next=6;break}h.addSuccess("Series details saved.",5e3),e.next=7;break;case 6:h.addFail("Server error: series details could not be saved.");case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function x(){return(x=Object(c.a)(s.a.mark((function e(t){var c;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return c={id:0,seriesId:n.id,genreId:t.id,genreName:t.name},e.next=3,O(c,p.i.insertSeriesGenre,d.ECallType.INSERT);case 3:c.id=e.sent,c.id>0?r(Object(i.a)(Object(i.a)({},n),{},{genres:[].concat(Object(a.a)(n.genres),[c])})):h.addFail("Server error: could not add genre.");case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function k(){return(k=Object(c.a)(s.a.mark((function e(t){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,O({id:t},p.i.deleteSeriesGenre,d.ECallType.ISOK);case 2:if(!e.sent){e.next=6;break}r(Object(i.a)(Object(i.a)({},n),{},{genres:n.genres.filter((function(e){return e.id!==t}))})),e.next=7;break;case 6:h.addFail("Server error: could not delete genre.");case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}return Object(l.useEffect)((function(){return n.id>0&&function(){g.apply(this,arguments)}(),function(){E.abort(),h.clear()}}),[]),Object(l.useEffect)((function(){n&&(document.title="(Edit) ".concat(n.title," - Rewer"))}),[n]),u.a.createElement("div",{className:"main-container"},u.a.createElement("br",null),n.id>0?u.a.createElement("button",{onClick:function(){return w.apply(this,arguments)}},"Save series details"):u.a.createElement("button",{onClick:function(){return y.apply(this,arguments)}},"Create series"),u.a.createElement(D,{series:n,setSeries:r,bindSeries:b}),n.id>0?u.a.createElement(l.Fragment,null,u.a.createElement(m.a,{movie:n,onAdd:function(e){!function(e){x.apply(this,arguments)}(e)},onDelete:function(e){!function(e){k.apply(this,arguments)}(e)}}),u.a.createElement(I,{series:n,setSeasons:function(e){r(Object(i.a)(Object(i.a)({},n),{},{seasons:e}))}})):u.a.createElement(l.Fragment,null))}},62:function(e,t,n){"use strict";n.d(t,"i",(function(){return d})),n.d(t,"j",(function(){return p})),n.d(t,"h",(function(){return m})),n.d(t,"f",(function(){return b})),n.d(t,"d",(function(){return v})),n.d(t,"e",(function(){return j})),n.d(t,"b",(function(){return O})),n.d(t,"g",(function(){return E})),n.d(t,"c",(function(){return h})),n.d(t,"a",(function(){return x}));var a=n(2),r=n.n(a),s=n(19),i=n(27),c=n(3),o=n(13),l=n(61),u=n(59),d={insertSeries:"/series/insert_series",updateSeries:"/series/update_series",uploadSeriesPoster:"/series/upload_series_poster",selectDetailedSeries:"/series/select_detailed_series",selectLatestPreviewSeries:"/series/select_latest_preview_series",selectLatestPreviewSeriesJson:"/jsondb/latest_series.json",insertSeriesGenre:"/genre/insert_series_genre",deleteSeriesGenre:"/genre/delete_series_genre"};function p(e){return f.apply(this,arguments)}function f(){return(f=Object(c.a)(r.a.mark((function e(t){return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(o.UploadFile)("/series/upload_series_poster",t);case 2:if(!e.sent.ok){e.next=5;break}return e.abrupt("return",!0);case 5:return e.abrupt("return",!1);case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function m(e){e.genres.sort(u.a),function(e){var t,n=Object(i.a)(e.seasons);try{for(n.s();!(t=n.n()).done;){w(t.value)}}catch(a){n.e(a)}finally{n.f()}}(e);var t,n=Object(i.a)(e.seasons);try{for(n.s();!(t=n.n()).done;){t.value.episodes.sort(x)}}catch(a){n.e(a)}finally{n.f()}}function b(e){return e.seasons.filter((function(e){return e.episodes.length>0})).length}function v(e){var t=0;return e.seasons.forEach((function(e){t+=e.episodes.length})),t}function j(e){return e.seasons.length>0&&e.seasons[0].episodes.length>0?e.seasons[0].episodes[0].releaseDate:null}function O(e){var t,n=v(e),a=0,r=Object(i.a)(e.seasons);try{for(r.s();!(t=r.n()).done;){var s,c=t.value,o=Object(i.a)(c.episodes);try{for(o.s();!(s=o.n()).done;){var l=s.value;l.runtime>0&&(a+=l.runtime)}}catch(u){o.e(u)}finally{o.f()}}}catch(u){r.e(u)}finally{r.f()}return a/n}function E(e){var t,n=[],a=Object(i.a)(e.seasons);try{for(a.s();!(t=a.n()).done;){g(t.value,n)}}catch(r){a.e(r)}finally{a.f()}return n}function h(e){var t,n=0,a=0,r=Object(i.a)(e.seasons);try{for(r.s();!(t=r.n()).done;){var s,c=t.value,o=Object(i.a)(c.episodes);try{for(o.s();!(s=o.n()).done;){var l=s.value;l.avgScore>0&&(a+=l.avgScore,n++)}}catch(u){o.e(u)}finally{o.f()}}}catch(u){r.e(u)}finally{r.f()}return a/n}function g(e,t){var n,a=Object(i.a)(e.episodes);try{for(a.s();!(n=a.n()).done;){y(n.value,t)}}catch(r){a.e(r)}finally{a.f()}}function y(e,t){var n,a=Object(i.a)(e.casts);try{for(a.s();!(n=a.n()).done;){S(n.value,t)}}catch(r){a.e(r)}finally{a.f()}}function S(e,t){var n=t.find((function(t){return t.artistId===e.artistId}));null!=n?function(e,t){var n=t.characterNames;0===t.characterNames.filter((function(t){return t===e.name})).length&&n.push(e.name);t=Object(s.a)(Object(s.a)({},t),{},{episodeCount:t.episodeCount++,characterNames:n})}(e,n):t.push({artistId:e.artistId,artistName:e.artistName,episodeCount:1,characterNames:[e.name],castTypeId:e.castTypeId})}function w(e){var t,n=Object(i.a)(e.episodes);try{for(n.s();!(t=n.n()).done;){t.value.casts.sort(l.b)}}catch(a){n.e(a)}finally{n.f()}}function x(e,t){if(new Date(e.releaseDate)>new Date(t.releaseDate))return 1;if(new Date(e.releaseDate)<new Date(t.releaseDate))return-1;if(e.releaseDate===t.releaseDate){if(e.id>t.id)return 1;if(e.id<t.id)return-1}return 0}}}]);
//# sourceMappingURL=16.9c404f3b.chunk.js.map
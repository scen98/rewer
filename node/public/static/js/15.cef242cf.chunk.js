(this.webpackJsonprewer=this.webpackJsonprewer||[]).push([[15],{120:function(t,e,n){"use strict";n.r(e),n.d(e,"default",(function(){return b}));var a=n(19),r=n(2),i=n.n(r),c=n(3),u=n(12),o=n(0),s=n.n(o),l=n(83),d=n(13),f=n(57),p=n(56),h=n(65),v=n(26),g=(n(80),function(t){var e=t.artist,n=(t.setArtist,t.bindArtist),a=Object(o.useRef)(),r=Object(p.g)("/rewer/uploads/portraits","".concat(e.id,".jpg")),g=Object(u.a)(r,3),m=g[0],b=g[1],w=g[2],y=Object(d.uploadCaller)(l.a.uploadPortrait,void 0),j=Object(u.a)(y,2),x=j[0],O=j[1],E=Object(o.useContext)(v.a).messenger;function P(){return(P=Object(c.a)(i.a.mark((function t(){var n,r;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=new FormData,a.current.files[0]){t.next=4;break}return E.addWarning("No file was chosen."),t.abrupt("return");case 4:return t.next=6,Object(h.b)(a.current.files[0],400,600,.8);case 6:return r=t.sent,n.append("portrait",r,"".concat(e.id,".jpg")),t.next=10,x(l.a.uploadPortrait,n);case 10:if(!t.sent){t.next=15;break}w("/rewer/uploads/portraits","".concat(e.id,".jpg?").concat((new Date).getTime())),E.addSuccess("Portrait updated.",3e3),t.next=16;break;case 15:E.addWarning("Upload unsuccessful.");case 16:case"end":return t.stop()}}),t)})))).apply(this,arguments)}return Object(o.useEffect)((function(){return function(){O.abort(),E.clear()}}),[]),s.a.createElement("div",null,s.a.createElement("input",{value:e.name,onChange:n,type:"text",name:"name",placeholder:"Name",className:"name-input"}),s.a.createElement("div",{className:"detail-grid"},s.a.createElement("div",{className:"detail-grid-item span-2"},s.a.createElement("h3",null,"Born: "),s.a.createElement("input",{value:e.birthPlace,type:"text",onChange:n,name:"birthPlace",className:"place-input",placeholder:"Birthplace"}),s.a.createElement("input",{value:Object(f.f)(new Date(e.birthDate)),type:"date",onChange:n,name:"birthDate"}),s.a.createElement("br",null),s.a.createElement("h3",null,"Died: "),s.a.createElement("input",{value:e.deathPlace,type:"text",onChange:n,name:"deathPlace",className:"place-input",placeholder:"leave empty if irrelevant",title:"leave empty if irrelevant"}),s.a.createElement("input",{value:Object(f.f)(new Date(e.deathDate)).toString(),type:"date",onChange:n,name:"deathDate"}),s.a.createElement("textarea",{value:e.bio,onChange:n,name:"bio",placeholder:"Biography",rows:30})),s.a.createElement("div",{className:"detail-grid-item first"},s.a.createElement("img",{className:"portrait",src:m,onError:b,alt:"Portrait"}),s.a.createElement("br",null),e.id>0?s.a.createElement(o.Fragment,null,s.a.createElement("input",{ref:a,type:"file",accept:".png,.jpg",className:"file-input"}),s.a.createElement("p",null,"It is recommended to use pictures with the standard portrait image ratio (9:16)"),s.a.createElement("button",{onClick:function(){return P.apply(this,arguments)}},"Upload")):s.a.createElement(o.Fragment,null,s.a.createElement("p",null,"Create the artist's page to modify their portrait.")))))}),m=n(21);function b(){var t=Object(p.e)({id:parseInt(Object(m.b)("artistId")),name:"",birthPlace:"",birthDate:"",deathPlace:"",deathDate:"",bio:""}),e=Object(u.a)(t,3),n=e[0],r=e[1],f=e[2],h=Object(d.postCaller)({id:n.id},l.a.selectDetailedArtist),b=Object(u.a)(h,2),w=b[0],y=b[1],j=Object(o.useContext)(v.a).messenger;function x(){return(x=Object(c.a)(i.a.mark((function t(){var e;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,w();case 2:(e=t.sent)&&r(e);case 4:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function O(){return(O=Object(c.a)(i.a.mark((function t(){var e;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,w(n,l.a.insertArtist,d.ECallType.INSERT);case 2:(e=t.sent)?(j.addSuccess("Artist's page successfully created.",5e3),Object(m.a)({name:"artistId",value:e.toString()}),r(Object(a.a)(Object(a.a)({},n),{},{id:e}))):j.addFail("Internal error: the server was unable to fulfill your request.");case 4:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function E(){return(E=Object(c.a)(i.a.mark((function t(){return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,w(n,l.a.updateArtist,d.ECallType.ISOK);case 2:if(!t.sent){t.next=6;break}j.addSuccess("Changes saved.",5e3),t.next=7;break;case 6:j.addFail("Internal error: the server was unable to save changes.");case 7:case"end":return t.stop()}}),t)})))).apply(this,arguments)}return Object(o.useEffect)((function(){return n.id>0&&function(){x.apply(this,arguments)}(),function(){y.abort(),j.clear()}}),[]),Object(o.useEffect)((function(){n&&(document.title="(Edit) ".concat(n.name," - Rewer"))}),[n]),s.a.createElement("div",{className:"main-container"},s.a.createElement("br",null),n.id>0?s.a.createElement("button",{onClick:function(){return E.apply(this,arguments)}},"Save changes"):s.a.createElement("button",{onClick:function(){return O.apply(this,arguments)}},"Create artist's page"),s.a.createElement(g,{artist:n,setArtist:r,bindArtist:f}))}},56:function(t,e,n){"use strict";n.d(e,"d",(function(){return o})),n.d(e,"e",(function(){return s})),n.d(e,"c",(function(){return l})),n.d(e,"f",(function(){return d})),n.d(e,"b",(function(){return p})),n.d(e,"h",(function(){return h})),n.d(e,"a",(function(){return a})),n.d(e,"g",(function(){return v}));var a,r=n(28),i=n(19),c=n(12),u=n(0);function o(t){var e=Object(u.useRef)(t),n=Object(u.useState)(!1),a=Object(c.a)(n,2)[1];return[e,function(t){Object.is(e.current,t)||(e.current=t,a((function(t){return!t})))}]}function s(t){var e=Object(u.useState)(t),n=Object(c.a)(e,2),a=n[0],o=n[1];return[a,o,function(t){o(Object(i.a)(Object(i.a)({},a),{},Object(r.a)({},t.target.name,t.target.value)))}]}function l(t){var e=Object(u.useRef)(t),n=Object(u.useState)(!1),a=Object(c.a)(n,2)[1],o=function(t){Object.is(e.current,t)||(e.current=t,a((function(t){return!t})))};return[e,o,function(t){o(Object(i.a)(Object(i.a)({},e.current),{},Object(r.a)({},t.target.name,t.target.value)))}]}function d(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=f(t,e>0,e),a=Object(c.a)(n,2),r=a[0],i=a[1],o=Object(u.useState)(i),s=Object(c.a)(o,2),l=s[0],d=s[1],p=Object(u.useState)(r),h=Object(c.a)(p,2),v=h[0],g=h[1],m=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=f(t,e>0,e),a=Object(c.a)(n,2),r=a[0],i=a[1];g(r),d(i)};return[v,l,m]}function f(t,e,n){return e&&t.length>n?[t.substring(0,n)+"...",!0]:[t,!1]}function p(t,e){"Enter"===t.key&&e()}function h(t,e){var n=t;(t>1||t<0)&&(n=.8);var a=Object(u.useRef)(n),r=function(){window.innerHeight+window.scrollY>=document.body.offsetHeight*a.current&&e()};return[function(){window.addEventListener("scroll",r)},function(){window.removeEventListener("scroll",r)}]}function v(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:a.Normal,r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=Object(u.useState)("".concat(t,"/").concat(n).concat(e)),o=Object(c.a)(i,2),s=o[0],l=o[1],d=Object(u.useRef)(r),f=function(){d.current?(l("".concat(t,"/").concat(a.Normal).concat(e)),d.current=!1):l("".concat(t,"/").concat(n,"0.jpg"))},p=function(t,e){l("".concat(t,"/").concat(n).concat(e))};return[s,f,p]}!function(t){t.Normal="",t.Medium="medium-",t.Small="small-"}(a||(a={}))},57:function(t,e,n){"use strict";function a(t){return"".concat(t.getFullYear(),". ").concat(s[t.getMonth()]," ").concat(t.getDate())}function r(t){return new Date(t).getFullYear()}function i(t){return s[new Date(t).getMonth()]}function c(t){return new Date(t).getDate()}function u(t){var e=new Date(t);return"".concat(e.getDate()," ").concat(s[e.getMonth()]," ").concat(e.getFullYear())}function o(t){var e,n;return e=t.getMonth()<9?"0".concat(t.getMonth()+1):(t.getMonth()+1).toString(),n=t.getDate()<10?"0".concat(t.getDate()):t.getDate().toString(),"".concat(t.getFullYear(),"-").concat(e,"-").concat(n)}n.d(e,"e",(function(){return a})),n.d(e,"c",(function(){return r})),n.d(e,"b",(function(){return i})),n.d(e,"a",(function(){return c})),n.d(e,"d",(function(){return u})),n.d(e,"f",(function(){return o}));var s=["Janury","February","March","April","May","June","July","August","September","October","November","December"]},65:function(t,e,n){"use strict";n.d(e,"a",(function(){return c})),n.d(e,"b",(function(){return u}));var a=n(2),r=n.n(a),i=n(3),c=function(t,e,n){return t.map((function(t){return t===e?n:t}))};function u(t,e,n){return o.apply(this,arguments)}function o(){return(o=Object(i.a)(r.a.mark((function t(e,a,i){var c,u,o,s,l,d,f,p,h=arguments;return r.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return c=h.length>3&&void 0!==h[3]?h[3]:1,u=n(79),o=new u,t.next=5,o.compress([e],{size:1,quality:c,maxWidth:a,maxHeight:i,resize:!0});case 5:return s=t.sent,l=s[0],d=l.data,f=l.ext,p=u.convertBase64ToFile(d,f),t.abrupt("return",p);case 11:case"end":return t.stop()}}),t)})))).apply(this,arguments)}},79:function(t,e,n){t.exports=function(t){function e(a){if(n[a])return n[a].exports;var r=n[a]={exports:{},id:a,loaded:!1};return t[a].call(r.exports,r,r.exports,e),r.loaded=!0,r.exports}var n={};return e.m=t,e.c=n,e.p="",e(0)}([function(t,e,n){var a,r,i;r=[t,n(1),n(2),n(3),n(4),n(5),n(6)],a=function(t,e,n,a,r,i,c){"use strict";function u(t){return t&&t.__esModule?t:{default:t}}var o=u(e),s=u(n),l=u(a),d=u(r),f=u(i),p=u(c),h=function(){function t(t,e){for(var n=0;n<e.length;n++){var a=e[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}return function(e,n,a){return n&&t(e.prototype,n),a&&t(e,a),e}}(),v=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}return h(t,[{key:"attach",value:function(t,e){var n=this;return new Promise((function(a,r){var i=document.querySelector(t);i.setAttribute("accept","image/*"),i.addEventListener("change",(function(t){var r=n.compress([].concat(function(t){if(Array.isArray(t)){for(var e=0,n=Array(t.length);e<t.length;e++)n[e]=t[e];return n}return Array.from(t)}(t.target.files)),e);a(r)}),!1)}))}},{key:"compress",value:function(t,e){function n(t,e){var n=new f.default(e);return n.start=window.performance.now(),n.alt=t.name,n.ext=t.type,n.startSize=t.size,p.default.orientation(t).then((function(e){return n.orientation=e,l.default.load(t)})).then(function(t){return function(e){return d.default.load(e).then((function(e){if(t.startWidth=e.naturalWidth,t.startHeight=e.naturalHeight,t.resize){var n=d.default.resize(t.maxWidth,t.maxHeight)(e.naturalWidth,e.naturalHeight),a=n.width,r=n.height;t.endWidth=a,t.endHeight=r}else t.endWidth=e.naturalWidth,t.endHeight=e.naturalHeight;return s.default.imageToCanvas(t.endWidth,t.endHeight,t.orientation)(e)})).then((function(e){return t.iterations=1,t.base64prefix=o.default.prefix(t.ext),function t(e,n){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments[3],i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,c=arguments[5],u=s.default.canvasToBase64(e,a),l=o.default.size(u);return c+=1,l>r||a>i?t(e,l,a-.1,r,i,c):u}(e,t.startSize,t.quality,t.size,t.minQuality,t.iterations)})).then((function(e){return t.finalSize=o.default.size(e),o.default.data(e)})).then((function(e){t.end=window.performance.now();var n=t.end-t.start;return{data:e,prefix:t.base64prefix,elapsedTimeInSeconds:n/1e3,alt:t.alt,initialSizeInMb:s.default.size(t.startSize).MB,endSizeInMb:s.default.size(t.finalSize).MB,ext:t.ext,quality:t.quality,endWidthInPx:t.endWidth,endHeightInPx:t.endHeight,initialWidthInPx:t.startWidth,initialHeightInPx:t.startHeight,sizeReducedInPercent:(t.startSize-t.finalSize)/t.startSize*100,iterations:t.iterations}}))}}(n))}return Promise.all(t.map((function(t){return n(t,e)})))}}],[{key:"convertBase64ToFile",value:function(t,e){return s.default.base64ToFile(t,e)}}]),t}();t.exports=v},void 0===(i="function"==typeof a?a.apply(e,r):a)||(t.exports=i)},function(t,e,n){var a,r,i;r=[e],void 0===(i="function"==typeof(a=function(t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={size:function(t){var e=t.replace(/^data:image\/\w+;base64,/,"").length;return(e-814)/1.37},mime:function(t){return t.split(";")[0].match(/jpeg|png|gif/)[0]},data:function(t){return t.replace(/^data:image\/\w+;base64,/,"")},prefix:function(t){return"data:"+t+";base64,"}}})?a.apply(e,r):a)||(t.exports=i)},function(t,e,n){var a,r,i;r=[e],void 0===(i="function"==typeof(a=function(t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={base64ToFile:function(t){for(var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"image/jpeg",n=window.atob(t),a=[],r=0;r<n.length;r++)a[r]=n.charCodeAt(r);return new window.Blob([new Uint8Array(a)],{type:e})},imageToCanvas:function(t,e,n){var a=document.createElement("canvas"),r=a.getContext("2d");return a.width=t,a.height=e,function(i){if(!n||n>8)return r.drawImage(i,0,0,a.width,a.height),a;switch(n>4&&(a.width=e,a.height=t),n){case 2:r.translate(t,0),r.scale(-1,1);break;case 3:r.translate(t,e),r.rotate(Math.PI);break;case 4:r.translate(0,e),r.scale(1,-1);break;case 5:r.rotate(.5*Math.PI),r.scale(1,-1);break;case 6:r.rotate(.5*Math.PI),r.translate(0,-e);break;case 7:r.rotate(.5*Math.PI),r.translate(t,-e),r.scale(-1,1);break;case 8:r.rotate(-.5*Math.PI),r.translate(-t,0)}return n>4?r.drawImage(i,0,0,a.height,a.width):r.drawImage(i,0,0,a.width,a.height),a}},canvasToBase64:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.75,n=t.toDataURL("image/jpeg",e);return n},size:function(t){return{KB:t/1e3,MB:t/1e6}}}})?a.apply(e,r):a)||(t.exports=i)},function(t,e,n){var a,r,i;r=[e],void 0===(i="function"==typeof(a=function(t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={load:function(t){return new Promise((function(e,n){var a=new window.FileReader;a.addEventListener("load",(function(t){e(t.target.result)}),!1),a.addEventListener("error",(function(t){n(t)}),!1),a.readAsDataURL(t)}))}}})?a.apply(e,r):a)||(t.exports=i)},function(t,e,n){var a,r,i;r=[e],void 0===(i="function"==typeof(a=function(t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={load:function(t){return new Promise((function(e,n){var a=new window.Image;a.addEventListener("load",(function(){e(a)}),!1),a.addEventListener("error",(function(t){n(t)}),!1),a.src=t}))},resize:function(t,e){return function(n,a){if(!t&&!e)return{width:n,height:a};var r=n/a,i=void 0,c=void 0;return r>t/e?c=(i=Math.min(n,t))/r:i=(c=Math.min(a,e))*r,{width:i,height:c}}}}})?a.apply(e,r):a)||(t.exports=i)},function(t,e,n){var a,r,i;r=[e],void 0===(i="function"==typeof(a=function(t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function t(e){var n=e.quality,a=void 0===n?.75:n,r=e.size,i=void 0===r?2:r,c=e.maxWidth,u=void 0===c?1920:c,o=e.maxHeight,s=void 0===o?1920:o,l=e.resize,d=void 0===l||l;(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")})(this,t),this.start=window.performance.now(),this.end=null,this.alt=null,this.ext=null,this.startSize=null,this.startWidth=null,this.startHeight=null,this.size=1e3*i*1e3,this.endSize=null,this.endWidth=null,this.endHeight=null,this.iterations=0,this.base64prefix=null,this.quality=a,this.resize=d,this.maxWidth=u,this.maxHeight=s,this.orientation=1}})?a.apply(e,r):a)||(t.exports=i)},function(t,e,n){var a,r,i;r=[e],void 0===(i="function"==typeof(a=function(t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={orientation:function(t){return new Promise((function(e,n){var a=new window.FileReader;a.onload=function(t){var n=new DataView(t.target.result);65496!==n.getUint16(0,!1)&&e(-2);for(var a=n.byteLength,r=2;r<a;){var i=n.getUint16(r,!1);if(r+=2,65505===i){1165519206!==n.getUint32(r+=2,!1)&&e(-1);var c=18761===n.getUint16(r+=6,!1);r+=n.getUint32(r+4,c);var u=n.getUint16(r,c);r+=2;for(var o=0;o<u;o++)274===n.getUint16(r+12*o,c)&&e(n.getUint16(r+12*o+8,c))}else{if(65280!==(65280&i))break;r+=n.getUint16(r,!1)}}e(-1)},a.readAsArrayBuffer(t.slice(0,65536))}))}}})?a.apply(e,r):a)||(t.exports=i)}])},80:function(t,e,n){},83:function(t,e,n){"use strict";n.d(e,"a",(function(){return a}));var a={selectArtistsByKeyword:"/artist/select_artists_by_keyword",selectDetailedArtist:"/artist/select_detailed_artist",insertArtist:"/artist/insert_artist",updateArtist:"/artist/update_artist",uploadPortrait:"/artist/upload_portrait"}}}]);
//# sourceMappingURL=15.cef242cf.chunk.js.map